#!/usr/bin/env bash

ENV_FILE="GitHeart/Env.swift"

function generateEnvFile {
    echo "To avoid aggressive rate limiting from GitHub API the project needs your Personal Access Token."
    echo "Please follow instructions at https://bit.ly/3dGTdrH to create it."
    echo "You're not required to select any particular scopes."
    read -p "Personal Access Token: " ACCESS_TOKEN
    cat > "$ENV_FILE" <<- EOM
// This file is generated by './scripts/setup'.
// To update the file, please run './scripts/setup' again.

struct Env {
    let githubAccessToken = "$ACCESS_TOKEN"
}
EOM
    echo "Done."
}

if command -v mint &> /dev/null; then
    echo "Awesome! Mint is installed."
else
    echo "SwiftFormat is not available since Mint is not installed."
    echo "To install Mint, please follow instructions at https://github.com/yonaskolb/Mint"
fi

if test -e "$ENV_FILE"; then
    echo ""
    read -p "Env.swift file exists, do you want to update it? [y/n] " CONFIRMATION
    if test "$CONFIRMATION" = "y"; then
        generateEnvFile
    fi
else
    echo ""
    echo "Creating Env.swift file."
    generateEnvFile
fi

echo "Opening the project in Xcode..."
open GitHeart.xcodeproj
